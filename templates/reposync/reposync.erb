#!/bin/bash

mkdir -p <%= @logdir %>

exec > <%= @logdir %>/<%= @repo_id %>.log 2>&1

if [ -z "<%= @repo_path %>" ];
then
  echo "incorrect repo_path"
  exit 1
fi

if [ "<%= @repo_path %>" = "/" ];
then
  echo "root not allowed as repo_path"
  exit 1
fi

if [[ "<%= @repo_path %>" != /* ]];
then
  echo "error, repopath is not an absolute path"
  exit 1
fi

reposync  -l\
          --repoid=<%= @repo_id %> \
          <%- if @gpgcheck -%>
          --gpgcheck \
          <%- end -%>
          <%- if @delete -%>
          --delete \
          <%- end -%>
          <%- if @newest_only -%>
          --newest-only \
          <%- end -%>
          <%- if @comps -%>
          --downloadcomps \
          <%- end -%>
          <%- if @metadata -%>
          --download-metadata \
          <%- end -%>
          --download_path=<%= @repo_path%>
