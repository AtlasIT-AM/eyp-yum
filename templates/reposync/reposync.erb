#!/bin/bash

exec > <%= @basedir %>/last.run.<%= @repo_id %>.log 2>&1

if [ -z "<%= @repo_path %>" ];
then
  echo "incorrect repo_path"
  exit 1
fi

if [ "<%= @repo_path %>" = "/" ];
then
  echo "root not allowed as repo_path"
  exit 1
fi

if [[ "<%= @repo_path %>" != /* ]];
then
  echo "error, repopath is not an absolute path"
  exit 1
fi

reposync  -l\
          <% if @gpgcheck %>--gpgcheck<% end %> \
          <% if @delete %>--delete<% end %>\
          <% if @newest_only %>--newest-only<% end %>\
          --repoid=<%= @repo_id %> \
          --download_path=<%= @repo_path%> \
          <% if @comps %>--downloadcomps<% end %> \
          <% if @metadata %>--download-metadata<% end %>
